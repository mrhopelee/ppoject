<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>瀑布流二</title>
    <!-- External CSS all-->
    <link rel="stylesheet" href="http://libs.useso.com/js/bootstrap/3.2.0/css/bootstrap.css">
    <!-- In-document CSS -->
    <style>
        .HomePage {
            width: 1250px;
            margin: 0 auto;
        }
        @media all and (max-width: 1250px) {
            .HomePage {
                width: 1000px;
                margin: 0 auto;
            }
        }
        @media all and (max-width: 1000px) {
            .HomePage {
                width: 750px;
                margin: 0 auto;
            }
        }
        @media all and (max-width: 750px) {
            .HomePage {
                width: 500px;
                margin: 0 auto;
            }
        }
        @media all and (max-width: 500px) {
            .HomePage {
                width: 250px;
                margin: 0 auto;
            }
        }

        .Module {
            /*width: 250px;
            margin: 30px auto;*/
            /*text-align: center;*/
            position: relative;
            /*overflow: hidden;*/
            /*background-color: #DDDDDD;*/
        }

        .item {
            margin: 14px 7px 0 7px;
            width: 236px;
        }

        /*.i1 {
            position: absolute;
            left:200px;
            top: 200px;
        }*/

        .item > a > img {
            width: 236px;
        }

    </style>
    <!-- External JavaScript all -->
    <script src="http://libs.useso.com/js/jquery/2.1.1/jquery.js"></script>
    <script src="http://libs.useso.com/js/bootstrap/3.2.0/js/bootstrap.js"></script>
    <!--<script src="javascript/masonry.pkgd.js"></script>-->
    <!-- In-document JavaScript -->

</head>
<body>
<div class="HomePage">
    <div class="Module">
        <div class="item i1"><a href=""><img src="pblimg/P_001.jpg" alt=""/></a></div>
        <div class="item"><a href=""><img src="pblimg/P_002.jpg" alt=""/></a></div>
        <div class="item"><a href=""><img src="pblimg/P_003.jpg" alt=""/></a></div>
        <div class="item"><a href=""><img src="pblimg/P_004.jpg" alt=""/></a></div>
        <div class="item"><a href=""><img src="pblimg/P_005.jpg" alt=""/></a></div>
        <div class="item"><a href=""><img src="pblimg/P_006.jpg" alt=""/></a></div>
        <div class="item"><a href=""><img src="pblimg/P_007.jpg" alt=""/></a></div>
        <div class="item"><a href=""><img src="pblimg/P_008.jpg" alt=""/></a></div>
        <div class="item"><a href=""><img src="pblimg/P_009.jpg" alt=""/></a></div>
        <div class="item"><a href=""><img src="pblimg/P_010.jpg" alt=""/></a></div>
        <div class="item"><a href=""><img src="pblimg/P_011.jpg" alt=""/></a></div>
        <div class="item"><a href=""><img src="pblimg/P_012.jpg" alt=""/></a></div>
        <div class="item"><a href=""><img src="pblimg/P_013.jpg" alt=""/></a></div>
        <div class="item"><a href=""><img src="pblimg/P_014.jpg" alt=""/></a></div>
        <div class="item"><a href=""><img src="pblimg/P_015.jpg" alt=""/></a></div>
        <div class="item"><a href=""><img src="pblimg/P_016.jpg" alt=""/></a></div>
        <div class="item"><a href=""><img src="pblimg/P_017.jpg" alt=""/></a></div>
        <div class="item"><a href=""><img src="pblimg/P_018.jpg" alt=""/></a></div>
        <div class="item"><a href=""><img src="pblimg/P_019.jpg" alt=""/></a></div>
        <div class="item"><a href=""><img src="pblimg/P_020.jpg" alt=""/></a></div>
        <div class="item"><a href=""><img src="pblimg/P_021.jpg" alt=""/></a></div>
        <div class="item"><a href=""><img src="pblimg/P_022.jpg" alt=""/></a></div>
        <div class="item"><a href=""><img src="pblimg/P_023.jpg" alt=""/></a></div>
        <div class="item"><a href=""><img src="pblimg/P_024.jpg" alt=""/></a></div>
        <div class="item"><a href=""><img src="pblimg/P_025.jpg" alt=""/></a></div>
        <div class="item"><a href=""><img src="pblimg/P_026.jpg" alt=""/></a></div>
        <div class="item"><a href=""><img src="pblimg/P_027.jpg" alt=""/></a></div>
        <div class="item"><a href=""><img src="pblimg/P_028.jpg" alt=""/></a></div>
        <div class="item"><a href=""><img src="pblimg/P_029.jpg" alt=""/></a></div>
        <div class="item"><a href=""><img src="pblimg/P_030.jpg" alt=""/></a></div>
    </div>
</div>
<script>
    var moudle = $(".Module"),
            b = 250,
            mw,
            c;
    var temp = 31;  /*第一张未加载的图片*/
    var max =160;   /*图片总数*/

    function initch() {
        mw = moudle.width();
        c = mw/b;
        var arr = new Array(c);
        for (var i = 0; i < c; i++) {
            arr[i] = 0;
        }
        return arr;
    }
    function mins(p) {
        return p.indexOf(Math.min.apply(null, p));
        /*获取高度最小的列*/
    }
    function minh(p) {
        return Math.min.apply(null, p);
        /*获取高度最小的列*/
    }
    $(window).resize(function() {
        mw = moudle.width();
        c = mw/b;
        console.log("mw :" + mw + "c :" +c);
        rmove();
    });

    var timer = null;
    $(document).scroll(function() {
        if(temp <= max) {
            if (timer) {
                clearTimeout(timer);
                timer = null;
            }
            timer = setTimeout(function () {
                whenscroll();
            }, 300);
        }
    });

    function whenscroll() {
        if(temp <= max) {
            var getHeight = $(document).scrollTop() + (window.innerHeight || document.documentElement.clientHeight);
            if (moudle.offset().top + moudle.height() < getHeight) {
                append({l: moudle});

            }
        }
    }

    function append(parameters) {
        var str = null;
        if(temp <= max) {
            if(temp < 100) {
                str = "<div class=\"item\"><a href=\"\"><img src=\"pblimg/P_0"+temp+".jpg\" alt=\"\"/></a></div>"
                temp++;
            }else {
                str = "<div class=\"item\"><a href=\"\"><img src=\"pblimg/P_"+temp+".jpg\" alt=\"\"/></a></div>"
                temp++;
            }
            var l = parameters.l;
            l.append(str);
            rmove();
            return this;
        }else {
            return this;
        }
    }


    function rmove() {
        var item = $(".item");
        /*console.log("共" + item.length + "个item");*/
        var ch = initch();
        var minsite, now_top, now_left;
        for (var i = 0; i < item.length; i++) {
            var now = item.eq(i);
            minsite = mins(ch);
            now_left = minsite * b;
            now_top = ch[minsite];
            now.css({
                "position": "absolute",
                "left": now_left + "px",
                "top": now_top + "px"
            });
            ch[minsite] = ch[minsite] + now.height() + 14;

        }
        moudle.height(minh(ch));
        /*console.log("offset top :" + moudle.offset().top + "height :" + moudle.height());*/
        if (timer) {
            clearTimeout(timer);
            timer = null;
        }
        timer = setTimeout(function () {
            whenscroll();
        }, 100);
        return 0;
    }
    rmove();
</script>
</body>
</html>